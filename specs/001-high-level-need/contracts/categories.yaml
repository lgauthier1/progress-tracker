paths:
  /categories:
    get:
      summary: List categories
      description: Get all categories for the authenticated user
      tags:
        - Categories
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryWithCounts'
        '401':
          $ref: '../openapi.yaml#/responses/Unauthorized'
        '500':
          $ref: '../openapi.yaml#/responses/InternalError'
    
    post:
      summary: Create category
      description: Create a new category
      tags:
        - Categories
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategory'
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          $ref: '../openapi.yaml#/responses/ValidationError'
        '401':
          $ref: '../openapi.yaml#/responses/Unauthorized'
        '409':
          description: Category name already exists for this user
          content:
            application/json:
              schema:
                $ref: '../openapi.yaml#/components/schemas/Error'
              example:
                error:
                  code: DUPLICATE_ENTRY
                  message: Category with this name already exists
        '500':
          $ref: '../openapi.yaml#/responses/InternalError'
  
  /categories/{id}:
    get:
      summary: Get category
      description: Get a single category by ID with associated goals and habits counts
      tags:
        - Categories
      parameters:
        - name: id
          in: path
          required: true
          schema:
            $ref: '../openapi.yaml#/components/schemas/UUID'
      responses:
        '200':
          description: Category retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryWithCounts'
        '401':
          $ref: '../openapi.yaml#/responses/Unauthorized'
        '403':
          $ref: '../openapi.yaml#/responses/Forbidden'
        '404':
          $ref: '../openapi.yaml#/responses/NotFound'
        '500':
          $ref: '../openapi.yaml#/responses/InternalError'
    
    put:
      summary: Update category
      description: Update an existing category
      tags:
        - Categories
      parameters:
        - name: id
          in: path
          required: true
          schema:
            $ref: '../openapi.yaml#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCategory'
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          $ref: '../openapi.yaml#/responses/ValidationError'
        '401':
          $ref: '../openapi.yaml#/responses/Unauthorized'
        '403':
          $ref: '../openapi.yaml#/responses/Forbidden'
        '404':
          $ref: '../openapi.yaml#/responses/NotFound'
        '409':
          description: Category name already exists for this user
          content:
            application/json:
              schema:
                $ref: '../openapi.yaml#/components/schemas/Error'
        '500':
          $ref: '../openapi.yaml#/responses/InternalError'
    
    delete:
      summary: Delete category
      description: Delete a category (associated goals/habits will have categoryId set to null)
      tags:
        - Categories
      parameters:
        - name: id
          in: path
          required: true
          schema:
            $ref: '../openapi.yaml#/components/schemas/UUID'
      responses:
        '204':
          description: Category deleted successfully (no content)
        '401':
          $ref: '../openapi.yaml#/responses/Unauthorized'
        '403':
          $ref: '../openapi.yaml#/responses/Forbidden'
        '404':
          $ref: '../openapi.yaml#/responses/NotFound'
        '500':
          $ref: '../openapi.yaml#/responses/InternalError'

components:
  schemas:
    CreateCategory:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          maxLength: 100
          example: Health
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          example: '#10b981'
          description: Hex color code (e.g., #10b981 for green)
    
    UpdateCategory:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        color:
          oneOf:
            - type: string
              pattern: '^#[0-9A-Fa-f]{6}$'
            - type: 'null'
    
    Category:
      type: object
      required:
        - id
        - userId
        - name
        - createdAt
        - updatedAt
      properties:
        id:
          $ref: '../openapi.yaml#/components/schemas/UUID'
        userId:
          $ref: '../openapi.yaml#/components/schemas/UUID'
        name:
          type: string
          example: Health
        color:
          type: string
          nullable: true
          example: '#10b981'
        createdAt:
          $ref: '../openapi.yaml#/components/schemas/ISODateTime'
        updatedAt:
          $ref: '../openapi.yaml#/components/schemas/ISODateTime'
    
    CategoryWithCounts:
      allOf:
        - $ref: '#/components/schemas/Category'
        - type: object
          properties:
            goalsCount:
              type: integer
              minimum: 0
              example: 5
              description: Number of goals in this category
            habitsCount:
              type: integer
              minimum: 0
              example: 3
              description: Number of habits in this category

